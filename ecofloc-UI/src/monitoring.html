<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="output.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inria+Sans:wght@300;400;700&family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
    <title>Monitoring Dashboard</title>
</head>

<body class="flex flex-col divide-y-4 divide-emerald-400 inria-sans-regular overflow-hidden">
    <!-- Header -->
    <header class="flex flex-row justify-center align-center bg-zinc-800 text-white text-xl">
        <div class="w-full px-[26%] flex flex-row justify-between content-center">
            <a href="./">
                <h2 class="rounded-t transition duration-400 ease-in-out bg-zinc-800 hover:bg-zinc-600 hover:cursor-pointer text-center text-2xl font-semibold p-4">
                    Home
                </h2>
            </a>
            <a href="#">
                <h2 class="text-emerald-600 rounded-t transition duration-400 ease-in-out bg-zinc-800 hover:bg-zinc-600 hover:cursor-pointer text-center text-2xl font-semibold p-4">
                    Monitoring
                </h2>
            </a>
            <a href="components.html">
                <h2 class="rounded-t transition duration-400 ease-in-out bg-zinc-800 hover:text-emerald-600 hover:bg-zinc-600 hover:cursor-pointer text-center text-2xl font-semibold p-4">
                    Components
                </h2>
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class=" flex-1 flex flex-row bg-gradient-to-b from-zinc-900 via-zinc-800 to-zinc-900 text-white">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar-transition">
            <!-- Wrap button -->
            <button id="close-sidebar" class="sidebar-transition">
                <img src="./assets/arrow-left.svg" alt="back" class="size-[35px] sidebar-transition">
            </button>
            <!-- CheckBox list -->
            <div id="checkbox-list" class="space-y-2 sidebar-transition mt-[15%]">
                <label class="flex items-center space-x-2">
                    <input id="checkboxCPU" type="checkbox" checked class="w-5 h-5 accent-emerald-500">
                    <span>CPU</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input id="checkboxGPU" type="checkbox" checked class="w-5 h-5 accent-emerald-500">
                    <span>GPU</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input id="checkboxRAM" type="checkbox" checked class="w-5 h-5 accent-emerald-500">
                    <span>RAM</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input id="checkboxNIC" type="checkbox" checked class="w-5 h-5 accent-emerald-500">
                    <span>NIC</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input id="checkboxSD" type="checkbox" checked class="w-5 h-5 accent-emerald-500">
                    <span>SD</span>
                </label>
            </div>
            <!-- Ipt-TimeStamp -->
            <div id="input_ts" class="mt-4 sidebar-transition">
                <label class="block mb-2">Interval (ms)</label>
                <input type="number" min="500" value="1000" max="300000" step="250" class="w-full bg-zinc-700 text-white p-2 rounded-md">
            </div>
            <!-- Play/Stop buttons -->
            <div id="list-buttons" class="sidebar-transition">
                <button onclick="executeScript(); return false;" class="p-2">
                    <img src="./assets/play.svg" alt="play" class="size-[50px]">
                </button>
                <button class="p-2" onclick="stopExecutable()">
                    <img src="./assets/stop.svg" alt="stop" class="size-[50px]">
                </button>
            </div>
        </aside>        

        <!-- Graphs and Table -->
        <section id="main" class="flex-1 flex flex-col p-4 pb-2 gap-2">
            <!-- Graphs -->
            <div id="flex-graph" class="list-graph h-3/4">
                <div id="boxCPU" class="graph">
                    <h3 class="text-center font-semibold">CPU</h3>
                    <div id="graphCPU" class="responsive-graph flex-grow"></div>
                </div>
                <div id="boxGPU" class="graph">
                    <h3 class="text-center font-semibold">GPU</h3>
                    <div id="graphGPU" class="responsive-graph flex-grow"></div>
                </div>
                <div id="boxRAM" class="graph">
                    <h3 class="text-center font-semibold">RAM</h3>
                    <div id="graphRAM" class="responsive-graph flex-grow"></div>
                </div>
                <div id="boxNIC" class="graph">
                    <h3 class="text-center font-semibold">NIC</h3>
                    <div id="graphNIC" class="responsive-graph flex-grow"></div>
                </div>
                <div id="boxSD" class="graph">
                    <h3 class="text-center font-semibold">SD</h3>
                    <div id="graphSD" class="responsive-graph flex-grow"></div>
                </div>
                <div id="boxTOTAL" class="graph">
                    <h3 class="text-center font-semibold">Total Consumption</h3>
                    <div id="graphTOTAL" class="responsive-graph flex-grow"></div>
                </div>
            </div>

            <!-- Tables -->
             <div id="list-tab" class="w-full h-1/4 flex flex-row justify-between bg-zinc-800 rounded-md p-2 px-2 gap-5">
                <div id="process-tab" class="custom-table w-3/4">
                    <div class="custom-thead">
                        <div class="col-1">Process name</div>
                        <div class="col-2">PID</div>
                    </div>
                    <div class="custom-tbody ">
                        <!--remove example later-->
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>
                        <div class="line">
                            <div class="col-1 cell">Firefox.exe</div>
                            <div class="col-2 cell">12364 <input type="checkbox" id=""></div>
                        </div>

                    </div>
                </div>
                <div id="group-tab" class="custom-table w-1/4">
                    <div class="custom-thead col-3">
                        <div>Group Application</div>
                    </div>
                    <div class="custom-tbody">
                        <div class="line col-3">
                            <div>Office</div>
                            <input type="checkbox" id="">
                        </div>
                        <div class="line col-3">
                            <div>Browser</div>
                            <input type="checkbox" id="">
                        </div>
                        <div class="line col-3">
                            <div>...</div>
                            <input type="checkbox" id="">
                        </div>
                    </div>
                </div>
             </div>
        </section>
    </main>

    <!-- Script -->
    <script>

        const max_screen_height = "max-h-[" + window.innerHeight + "px]";
        const min_screen_height = "min-h-[" + window.innerHeight + "px]";
        document.body.classList.add(max_screen_height);
        document.body.classList.add(min_screen_height);
    

        const sidebar = document.getElementById('sidebar');
        const checkbox_list = document.getElementById('checkbox-list');
        const input_ts = document.getElementById('input_ts');
        const wrap_sidebar = document.getElementById('close-sidebar');
        const main = document.getElementById('main');
        const list_buttons = document.getElementById('list-buttons');

        // Open sidebar
        wrap_sidebar.addEventListener('click', () => {
            
            const timestamp = new Date().getTime();

            if (wrap_sidebar.id == "open-sidebar") {
                sidebar.classList.remove('close');
                checkbox_list.classList.remove('hide');
                list_buttons.classList.remove('fixed');
                input_ts.classList.remove('hide');
                wrap_sidebar.innerHTML = "<img src='./assets/arrow-left.svg' alt='back' class='size-[35px] sidebar-transition'>";
                wrap_sidebar.id = "close-sidebar";
            }else{
                sidebar.classList.add('close');
                checkbox_list.classList.add('hide');
                input_ts.classList.add('hide');
                list_buttons.classList.add('fixed');
                wrap_sidebar.innerHTML = "<img src='./assets/arrow-right.svg' alt='back' class='size-[35px] sidebar-transition'>";
                wrap_sidebar.id = "open-sidebar";


            }
        });

function executeScript() {
    // Address of your Node.js server
    const serverUrl = 'http://localhost:3000/execute';

    // Sending a POST request to the server
    fetch(serverUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        // Add data if necessary
        body: JSON.stringify({}),
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Script executed successfully :', data.stdout);
                //alert('Script executed successfully !');
            } else {
                console.error('Error during execution :', data.message);
                alert(`Error : ${data.message}`);
            }
        })
        .catch(error => {
            console.error('Network or server error :', error);
            alert('Unable to contact server.');
        });
}

// Define `stopExecutable` function outside `executeScript`
function stopExecutable() {
    fetch('http://localhost:3000/stop', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data => {
            console.log(data.message);
            alert(data.message);  // Display a message to the user
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to stop executable');
        });
}


    </script>
    <script src="graph.js"></script>
    <script src="displayGraph.js"></script>
</body>

</html>
